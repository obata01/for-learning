% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={第3章 一般化線形モデル（GLM）},
  pdfauthor={obata.yoshimasa},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{第3章 一般化線形モデル（GLM）}
\author{obata.yoshimasa}
\date{2021/9/26}

\begin{document}
\maketitle

\hypertarget{ux4e00ux822cux5316ux7ddaux5f62ux30e2ux30c7ux30eb}{%
\subsection{一般化線形モデル}\label{ux4e00ux822cux5316ux7ddaux5f62ux30e2ux30c7ux30eb}}

「ばらつきは何でもかんでも正規分布」と考えるのはおかしいだろう ------
というのが一般化線形モデル

ex) 目的変数がポアソン分布に従うと仮定したポアソン回帰

\hypertarget{ux4f8bux984cux500bux4f53ux3054ux3068ux306bux5e73ux5747ux7a2eux5b50ux6570ux304cux7570ux306aux308bux5834ux5408}{%
\subsection{3.1
例題：個体ごとに平均種子数が異なる場合}\label{ux4f8bux984cux500bux4f53ux3054ux3068ux306bux5e73ux5747ux7a2eux5b50ux6570ux304cux7570ux306aux308bux5834ux5408}}

標本：架空植物100個体

\begin{itemize}
\tightlist
\item
  種子数 \(y_i\) (目的変数)
\item
  属性（誤差（個体差）を与える観測データ）

  \begin{itemize}
  \tightlist
  \item
    体サイズ \(x_i\)
  \item
    施肥処理の有無 \(f_i\) (f : Factor)

    \begin{itemize}
    \tightlist
    \item
      処理C：全個体中50個体 \((i \in {1, 2, \cdots, 50})\)
      は何も処理をしていない群
    \item
      処理T：残りの50個体 \((i \in {51, 52, \cdots, 100})\)
      は処理（肥料）を加えた群
    \end{itemize}
  \end{itemize}
\end{itemize}

→ \(x_i\) と \(f_i\) が種子数 \(y_i\) にどう影響しているのか知りたい.

\hypertarget{ux89b3ux6e2cux3055ux308cux305fux30c7ux30fcux30bfux306eux6982ux8981ux3092ux8abfux3079ux308b}{%
\subsection{3.2
観測されたデータの概要を調べる}\label{ux89b3ux6e2cux3055ux308cux305fux30c7ux30fcux30bfux306eux6982ux8981ux3092ux8abfux3079ux308b}}

\hypertarget{ux30c7ux30fcux30bfux8aadux307fux8fbcux307f}{%
\subsubsection{データ読み込み}\label{ux30c7ux30fcux30bfux8aadux307fux8fbcux307f}}

CSVファイルを読み込んでデータフレームとして変数dに格納

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# f列をfactorとするため, 引数に"stringsAsFactors = TRUE"を追加}
\NormalTok{d }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"../data/data3a.csv"}\NormalTok{, }\AttributeTok{stringsAsFactors =} \ConstantTok{TRUE}\NormalTok{)}
\CommentTok{\# print(d)}
\FunctionTok{head}\NormalTok{(d, }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    y     x f
## 1  6  8.31 C
## 2  6  9.44 C
## 3  6  9.50 C
## 4 12  9.07 C
## 5 10 10.16 C
\end{verbatim}

デフォルトがFALSEになっているため注意

-\textgreater{}
\url{https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/read.table}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{getOption}\NormalTok{(}\StringTok{"stringsAsFactors"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\hypertarget{ux6982ux8981ux306eux78baux8a8d}{%
\subsubsection{概要の確認}\label{ux6982ux8981ux306eux78baux8a8d}}

\hypertarget{ux5217ux3054ux3068ux306eux78baux8a8d}{%
\paragraph{列ごとの確認}\label{ux5217ux3054ux3068ux306eux78baux8a8d}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# x列・y列のみの表示}
\NormalTok{d}\SpecialCharTok{$}\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1]  8.31  9.44  9.50  9.07 10.16  8.32 10.61 10.06  9.93 10.43 10.36 10.15
##  [13] 10.92  8.85  9.42 11.11  8.02 11.93  8.55  7.19  9.83 10.79  8.89 10.09
##  [25] 11.63 10.21  9.45 10.44  9.44 10.48  9.43 10.32 10.33  8.50  9.41  8.96
##  [37]  9.67 10.26 10.36 11.80 10.94 10.25  8.74 10.46  9.37  9.74  8.95  8.74
##  [49] 11.32  9.25 10.14  9.05  9.89  8.76 12.04  9.91  9.84 11.87 10.16  9.34
##  [61] 10.17 10.99  9.19 10.67 10.96 10.55  9.69 10.91  9.60 12.37 10.54 11.30
##  [73] 12.40 10.18  9.53 10.24 11.76  9.52 10.40  9.96 10.30 11.54  9.42 11.28
##  [85]  9.73 10.78 10.21 10.51 10.73  8.85 11.20  9.86 11.54 10.03 11.88  9.15
##  [97]  8.52 10.24 10.86  9.97
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d}\SpecialCharTok{$}\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1]  6  6  6 12 10  4  9  9  9 11  6 10  6 10 11  8  3  8  5  5  4 11  5 10  6
##  [26]  6  7  9  3 10  2  9 10  5 11 10  4  8  9 12  8  9  8  6  6 10 10  9 12  6
##  [51] 14  6  7  9  6  7  9 13  9 13  7  8 10  7 12  6 15  3  4  6 10  8  8  7  5
##  [76]  6  8  9  9  6  7 10  6 11 11 11  5  6  4  5  6  5  8  5  9  8  6  8  7  9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# f列(因子：factor)のみの表示}
\CommentTok{\# CSVファイルを読み込んだ時、文字列を含む列はfactorに変換される.}
\NormalTok{d}\SpecialCharTok{$}\NormalTok{f}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C
##  [38] C C C C C C C C C C C C C T T T T T T T T T T T T T T T T T T T T T T T T
##  [75] T T T T T T T T T T T T T T T T T T T T T T T T T T
## Levels: C T
\end{verbatim}

\hypertarget{classux3092ux7528ux3044ux3066ux30c7ux30fcux30bfux30aaux30d6ux30b8ux30a7ux30afux30c8ux304cux5c5eux3059ux308bux30afux30e9ux30b9ux3092ux8868ux793a}{%
\paragraph{class()を用いてデータオブジェクトが属するクラスを表示}\label{classux3092ux7528ux3044ux3066ux30c7ux30fcux30bfux30aaux30d6ux30b8ux30a7ux30afux30c8ux304cux5c5eux3059ux308bux30afux30e9ux30b9ux3092ux8868ux793a}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# yは整数のみのため"integer"}
\FunctionTok{class}\NormalTok{(d}\SpecialCharTok{$}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# xは実数も含むため"numeric"}
\FunctionTok{class}\NormalTok{(d}\SpecialCharTok{$}\NormalTok{x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# fは文字列を含むため"factor"}
\FunctionTok{class}\NormalTok{(d}\SpecialCharTok{$}\NormalTok{f)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "factor"
\end{verbatim}

\hypertarget{ux57faux672cux7d71ux8a08ux91cf}{%
\paragraph{基本統計量}\label{ux57faux672cux7d71ux8a08ux91cf}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        y               x          f     
##  Min.   : 2.00   Min.   : 7.190   C:50  
##  1st Qu.: 6.00   1st Qu.: 9.428   T:50  
##  Median : 8.00   Median :10.155         
##  Mean   : 7.83   Mean   :10.089         
##  3rd Qu.:10.00   3rd Qu.:10.685         
##  Max.   :15.00   Max.   :12.400
\end{verbatim}

\hypertarget{ux7d71ux8a08ux30e2ux30c7ux30eaux30f3ux30b0ux306eux524dux306bux30c7ux30fcux30bfux3092ux56f3ux793aux3059ux308b}{%
\subsection{3.3
統計モデリングの前にデータを図示する}\label{ux7d71ux8a08ux30e2ux30c7ux30eaux30f3ux30b0ux306eux524dux306bux30c7ux30fcux30bfux3092ux56f3ux793aux3059ux308b}}

\hypertarget{ux6563ux5e03ux56f3}{%
\subsubsection{散布図}\label{ux6563ux5e03ux56f3}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(d}\SpecialCharTok{$}\NormalTok{x, d}\SpecialCharTok{$}\NormalTok{y, }\AttributeTok{pch =} \FunctionTok{c}\NormalTok{(}\DecValTok{21}\NormalTok{, }\DecValTok{19}\NormalTok{)[d}\SpecialCharTok{$}\NormalTok{f])}
\FunctionTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{, }\AttributeTok{legend =} \FunctionTok{c}\NormalTok{(}\StringTok{"C"}\NormalTok{, }\StringTok{"T"}\NormalTok{), }\AttributeTok{pch =} \FunctionTok{c}\NormalTok{(}\DecValTok{21}\NormalTok{, }\DecValTok{19}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{ch3_files/figure-latex/unnamed-chunk-7-1.pdf}

\hypertarget{ux7bb1ux3072ux3052ux56f3}{%
\subsubsection{箱ひげ図}\label{ux7bb1ux3072ux3052ux56f3}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(d}\SpecialCharTok{$}\NormalTok{f, d}\SpecialCharTok{$}\NormalTok{y)}
\FunctionTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{, }\AttributeTok{legend =} \FunctionTok{c}\NormalTok{(}\StringTok{"C"}\NormalTok{, }\StringTok{"T"}\NormalTok{), }\AttributeTok{pch =} \FunctionTok{c}\NormalTok{(}\DecValTok{21}\NormalTok{, }\DecValTok{19}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{ch3_files/figure-latex/unnamed-chunk-8-1.pdf}

\hypertarget{ux7ddaux5f62ux4e88ux6e2cux5b50ux3068ux5bfeux6570ux30eaux30f3ux30afux95a2ux6570}{%
\subsection{3.4.1
線形予測子と対数リンク関数}\label{ux7ddaux5f62ux4e88ux6e2cux5b50ux3068ux5bfeux6570ux30eaux30f3ux30afux95a2ux6570}}

ポアソン回帰の説明はこちらが詳しい -\textgreater{}
\url{https://www.slideshare.net/logics-of-blue/2-3glm}

\hypertarget{ux30ddux30a2ux30bdux30f3ux5206ux5e03}{%
\paragraph{ポアソン分布}\label{ux30ddux30a2ux30bdux30f3ux5206ux5e03}}

第2章同様、ある個体 \(i\) の種子数が \(y_i\) である確率
\(p(y_i|\lambda_i)\) は, ポアソン分布に従うと仮定する.

\[
  p(y_i | \lambda_i) = \frac{\lambda_i^{y_i} exp(-\lambda_i)}{y_i !}
\]

\hypertarget{ux7ddaux5f62ux4e88ux6e2cux5b50ux3068ux30eaux30f3ux30afux95a2ux6570}{%
\paragraph{線形予測子とリンク関数}\label{ux7ddaux5f62ux4e88ux6e2cux5b50ux3068ux30eaux30f3ux30afux95a2ux6570}}

個体ごとに異なる平均種子数 \(\lambda_i\) を説明変数 \(x_i\)
の関数として定義する.

ポアソン分布は\(\lambda\)によって決まるため、\(\lambda\)を推定する予測式を立てる必要がある.

-\textgreater{} つまり、ある個体の体サイズ \(x_i\) に応じて \(\lambda\)
が異なる. -\textgreater{}
つまり、例えばサイズが8のとき種子数は平均6を前後にばらつき、
　　サイズが10のときは種子数は平均10を前後にばらつく･･･といったようになるが,
その誤差はポアソン分布に従う.

\[
  \lambda_i = exp(\beta_1 + \beta_2 x_i) \\
  \Leftrightarrow \ log \lambda_i = \beta_1 + \beta_2 x_i \ \ \cdots ①
\]

上記式はポアソン分布・二項分布の\emph{正準リンク関数}となっている.
※ロジスティック回帰の正準リンク関数はロジットリンク関数

①式の左辺と右辺はそれぞれ次のように呼ぶ. - 左辺：(対数)リンク関数 -
右辺：線形予測子

ポアソン回帰のGLMで対数リンク関数が用いられる理由 -
\(\lambda = exp(線形予測子) \ge 0\) であり, 常に非負になる

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lambda\_a }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  β\_1 }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{  β\_2 }\OtherTok{\textless{}{-}} \FloatTok{0.4}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{exp}\NormalTok{(β\_1 }\SpecialCharTok{+}\NormalTok{ β\_2}\SpecialCharTok{*}\NormalTok{x))}
\NormalTok{\}}

\NormalTok{lambda\_b }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  β\_1 }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{2}
\NormalTok{  β\_2 }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FloatTok{0.8}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{exp}\NormalTok{(β\_1 }\SpecialCharTok{+}\NormalTok{ β\_2}\SpecialCharTok{*}\NormalTok{x))}
\NormalTok{\}}

\FunctionTok{plot}\NormalTok{(lambda\_a, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\AttributeTok{ylab=}\StringTok{"λ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in title(...): conversion failure on 'λ' in 'mbcsToSbcs': dot
## substituted for <ce>
\end{verbatim}

\begin{verbatim}
## Warning in title(...): conversion failure on 'λ' in 'mbcsToSbcs': dot
## substituted for <bb>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{new=}\NormalTok{T)}
\FunctionTok{plot}\NormalTok{(lambda\_b, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\AttributeTok{ylab=}\StringTok{""}\NormalTok{, }\AttributeTok{lty=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{ch3_files/figure-latex/unnamed-chunk-9-1.pdf}

\hypertarget{ux3042ux3066ux306fux3081ux3068ux3042ux3066ux306fux307eux308aux306eux826fux3055}{%
\subsection{3.4.2
あてはめとあてはまりの良さ}\label{ux3042ux3066ux306fux3081ux3068ux3042ux3066ux306fux307eux308aux306eux826fux3055}}

ポアソン回帰は、対数尤度\(logL\) が最大になるパラメータ
\(\hat{\beta_1}, \hat{\beta_2}\) を決めること.

\[
  \log L(\beta_1, \beta_2) = \sum_{i} \log \frac{\lambda_i^{y_i} exp(-\lambda_i)}{y_i !}
\]

Rでは次のように実行

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{data =}\NormalTok{ d, }\AttributeTok{family =} \FunctionTok{poisson}\NormalTok{(}\AttributeTok{link =} \StringTok{"log"}\NormalTok{))}
\NormalTok{fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:  glm(formula = y ~ x, family = poisson(link = "log"), data = d)
## 
## Coefficients:
## (Intercept)            x  
##     1.29172      0.07566  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  98 Residual
## Null Deviance:       89.51 
## Residual Deviance: 84.99     AIC: 474.8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = y ~ x, family = poisson(link = "log"), data = d)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.3679  -0.7348  -0.1775   0.6987   2.3760  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(>|z|)    
## (Intercept)  1.29172    0.36369   3.552 0.000383 ***
## x            0.07566    0.03560   2.125 0.033580 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 89.507  on 99  degrees of freedom
## Residual deviance: 84.993  on 98  degrees of freedom
## AIC: 474.77
## 
## Number of Fisher Scoring iterations: 4
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Estimate : 最尤推定値
\item
  Std.Error : Estimateのばらつきが正規分布であると仮定したときの標準誤差
\item
  z value : Estimate / Std.Error. Wald信頼区間を構成でき,
  Wald統計量とも呼ばれる.
\item
  Pr(\textgreater\textbar z\textbar) : (今回のポアソン回帰の場合)
  P値にみたてて検定することが可能　※詳細は書籍参照
\end{enumerate}

ただし, モデル評価は第４章のモデル選択を使用した方が良い.

最大対数尤度は次のように表示

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{logLik}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'log Lik.' -235.3863 (df=2)
\end{verbatim}

\hypertarget{ux30ddux30a2ux30bdux30f3ux56deux5e30ux306bux3088ux308bux4e88ux6e2c}{%
\subsection{3.4.3
ポアソン回帰による予測}\label{ux30ddux30a2ux30bdux30f3ux56deux5e30ux306bux3088ux308bux4e88ux6e2c}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xx }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(d}\SpecialCharTok{$}\NormalTok{x), }\FunctionTok{max}\NormalTok{(d}\SpecialCharTok{$}\NormalTok{x), }\AttributeTok{length =} \DecValTok{100}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(d}\SpecialCharTok{$}\NormalTok{x, d}\SpecialCharTok{$}\NormalTok{y, }\AttributeTok{pch =} \FunctionTok{c}\NormalTok{(}\DecValTok{21}\NormalTok{, }\DecValTok{19}\NormalTok{)[d}\SpecialCharTok{$}\NormalTok{f])}
\FunctionTok{lines}\NormalTok{(xx, }\FunctionTok{exp}\NormalTok{(}\FloatTok{1.29} \SpecialCharTok{+} \FloatTok{0.0757} \SpecialCharTok{*}\NormalTok{ xx), }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{ch3_files/figure-latex/unnamed-chunk-12-1.pdf}

\hypertarget{ux8aacux660eux5909ux6570ux304cux56e0ux5b50ux578bux306eux7d71ux8a08ux30e2ux30c7ux30eb}{%
\subsection{3.5
説明変数が因子型の統計モデル}\label{ux8aacux660eux5909ux6570ux304cux56e0ux5b50ux578bux306eux7d71ux8a08ux30e2ux30c7ux30eb}}

次のようにダミー変数化してモデルに組み込む.

\[
 \lambda_i = exp(\beta_1 + \beta_3 d_i) \\
 d_i = \left\{
   \begin{array}{ll}
   0 & (f_i = C) \\
   1 & (f_i = T)
   \end{array}
   \right.
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit\_f }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ f, }\AttributeTok{data =}\NormalTok{ d, }\AttributeTok{family =}\NormalTok{ poisson)}
\NormalTok{fit\_f}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:  glm(formula = y ~ f, family = poisson, data = d)
## 
## Coefficients:
## (Intercept)           fT  
##     2.05156      0.01277  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  98 Residual
## Null Deviance:       89.51 
## Residual Deviance: 89.48     AIC: 479.3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(fit\_f)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = y ~ f, family = poisson, data = d)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.47515  -0.69941   0.04264   0.72467   2.25204  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(>|z|)    
## (Intercept)  2.05156    0.05070  40.463   <2e-16 ***
## fT           0.01277    0.07148   0.179    0.858    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 89.507  on 99  degrees of freedom
## Residual deviance: 89.475  on 98  degrees of freedom
## AIC: 479.25
## 
## Number of Fisher Scoring iterations: 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{logLik}\NormalTok{(fit\_f)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'log Lik.' -237.6273 (df=2)
\end{verbatim}

\hypertarget{ux8aacux660eux5909ux6570ux304cux6570ux91cfux578bux56e0ux5b50ux578b}{%
\subsection{3.6
説明変数が数量型＋因子型}\label{ux8aacux660eux5909ux6570ux304cux6570ux91cfux578bux56e0ux5b50ux578b}}

次のような重回帰式で考える.

\[
  \log \lambda_i = \beta_1 + \beta_2 x_i + \beta_3d_i
\]

Rを実行すると施肥処理の効果（fT）のEstimateが正であったのに、
このモデルではマイナスと推定される.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit\_all }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ f, }\AttributeTok{data =}\NormalTok{ d, }\AttributeTok{family =}\NormalTok{ poisson)}
\NormalTok{fit\_all}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:  glm(formula = y ~ x + f, family = poisson, data = d)
## 
## Coefficients:
## (Intercept)            x           fT  
##     1.26311      0.08007     -0.03200  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  97 Residual
## Null Deviance:       89.51 
## Residual Deviance: 84.81     AIC: 476.6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(fit\_all)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = y ~ x + f, family = poisson, data = d)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.3977  -0.7337  -0.2023   0.6795   2.4317  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(>|z|)    
## (Intercept)  1.26311    0.36963   3.417 0.000633 ***
## x            0.08007    0.03704   2.162 0.030620 *  
## fT          -0.03200    0.07438  -0.430 0.667035    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 89.507  on 99  degrees of freedom
## Residual deviance: 84.808  on 97  degrees of freedom
## AIC: 476.59
## 
## Number of Fisher Scoring iterations: 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{logLik}\NormalTok{(fit\_all)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'log Lik.' -235.2937 (df=3)
\end{verbatim}

\hypertarget{ux5bfeux6570ux30eaux30f3ux30afux95a2ux6570ux306eux308fux304bux308aux3084ux3059ux3055ux304bux3051ux7b97ux3055ux308cux308bux52b9ux679c}{%
\subsection{3.6.1
対数リンク関数のわかりやすさ：かけ算される効果}\label{ux5bfeux6570ux30eaux30f3ux30afux95a2ux6570ux306eux308fux304bux308aux3084ux3059ux3055ux304bux3051ux7b97ux3055ux308cux308bux52b9ux679c}}

対数リンク関数は足し算のように見えて掛け算で表される.

サイズ\(x_i\)が大きいほど、

\[
  \lambda_i = exp(\beta_1 + \beta_2 x_i + \beta_3d_i)  \\
  = exp(\beta_1) × exp(\beta_2 x_i) × exp(\beta_3 d_i)
\]

詳細は書籍参照.

\hypertarget{ux4f55ux3067ux3082ux6b63ux898fux5206ux5e03ux4f55ux3067ux3082ux76f4ux7ddaux306bux306fux7121ux7406ux304cux3042ux308b}{%
\subsection{3.7
「何でも正規分布」「何でも直線」には無理がある}\label{ux4f55ux3067ux3082ux6b63ux898fux5206ux5e03ux4f55ux3067ux3082ux76f4ux7ddaux306bux306fux7121ux7406ux304cux3042ux308b}}

線形回帰(LM)を仮定した場合の指摘点 -
正規分布は連続的な値を扱う確率分布だったはずでは？ -
カウントデータなのに平均値の予測がマイナスになる理由は？ -
図でみると「ばらつき一定」ではなさそうなのに、分散一定を仮定？

ポアソン分布のGLMで説明しようとした場合の利点 -
ポアソン分布を使っているのでカウントデータに正しく対応 -
対数リンク関数を使えば平均値はつねに非負 - \(y\)
のばらつきは平均とともに増大する

\end{document}
